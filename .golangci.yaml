version: "2"
linters:
  default: none
  enable:
    - asasalint
    - asciicheck
    - bidichk
    - bodyclose
    - canonicalheader
    - containedctx
    - contextcheck
    - copyloopvar
    - cyclop
    - decorder
    - depguard
    - dogsled
    - dupl
    - dupword
    - durationcheck
    - err113
    - errcheck
    - errchkjson
    - errname
    - errorlint
    - exhaustive
    - exhaustruct
    - fatcontext
    - forbidigo
    - forcetypeassert
    - funlen
    - gocheckcompilerdirectives
    - gochecknoglobals
    - gochecknoinits
    - gochecksumtype
    - gocognit
    - goconst
    - gocritic
    - gocyclo
    - godot
    - godox
    - goheader
    - gomoddirectives
    - goprintffuncname
    - gosec
    - gosmopolitan
    - govet
    - importas
    - inamedparam
    - ineffassign
    - interfacebloat
    - intrange
    - ireturn
    - lll
    - maintidx
    - makezero
    - mirror
    - misspell
    - mnd
    - musttag
    - nakedret
    - nestif
    - nilerr
    - nilnil
    - nlreturn
    - noctx
    - nolintlint
    - nosprintfhostport
    - paralleltest
    - perfsprint
    - prealloc
    - predeclared
    - promlinter
    - protogetter
    - reassign
    - revive
    - rowserrcheck
    - sloglint
    - spancheck
    - sqlclosecheck
    - staticcheck
    - tagalign
    - tagliatelle
    - testableexamples
    - testifylint
    - thelper
    - unconvert
    - unparam
    - unused
    - usestdlibvars
    - usetesting
    - varnamelen
    - wastedassign
    - whitespace
    - wrapcheck
    - wsl_v5
    - zerologlint
  settings:
    cyclop:
      max-complexity: 15
    depguard:
      rules:
        main:
          list-mode: lax
          files:
            - $all
          allow:
            - $gostd
            - github.com/mstoykov/atlas
            - github.com/sirupsen/logrus
            - go.k6.io/k6/metrics
            - go.k6.io/k6/output
          deny:
            - pkg: github.com/pkg/errors
              desc: Should be replaced by standard lib errors package
        test:
          list-mode: lax
          files:
            - $test
          allow:
            - $gostd
            - github.com/mstoykov/atlas
            - github.com/sirupsen/logrus
            - github.com/stretchr/testify/assert
            - github.com/stretchr/testify/require
            - go.k6.io/k6/metrics
            - go.k6.io/k6/output
          deny:
            - pkg: github.com/pkg/errors
              desc: Should be replaced by standard lib errors package
    exhaustruct:
      exclude:
        - github.com/prometheus/prometheus/prompb.Label
        - github.com/prometheus/prometheus/prompb.TimeSeries
        - github.com/prometheus/prometheus/prompb.Sample
        - github.com/prometheus/client_golang/prometheus.CounterOpts
        - github.com/prometheus/client_golang/prometheus.GaugeOpts
        - github.com/prometheus/client_golang/prometheus.SummaryOpts
        - github.com/prometheus/client_golang/prometheus.HistogramOpts
    forbidigo:
      forbid:
        - pattern: ^print.*$
        - pattern: ^fmt\.Print.*$
          msg: Do not commit print statements. Use a logger instead.
      analyze-types: true
    goconst:
      min-len: 5
      min-occurrences: 5
      numbers: true
    gocritic:
      disable-all: true
      enabled-tags:
        - diagnostic
        - style
        - performance
      settings:
        ruleguard:
          rules: internal/ruleguard/rules.go
    gocyclo:
      min-complexity: 20
    godox:
      keywords:
        - BUG
        - FIXME
        - HACK
        - OPTIMIZE
    goheader:
      values:
        const:
          COMPANY: Grafana Labs
      template: |-
        Copyright (C) {{ MOD-YEAR }} {{ COMPANY }}.
        SPDX-License-Identifier: AGPL-3.0-only
    gomoddirectives:
      replace-local: false
      retract-allow-no-explanation: false
    gosec:
      severity: low
      confidence: low
    importas:
      alias:
        - pkg: github.com/grafana/synthetic-monitoring-agent/pkg/pb/synthetic_monitoring
          alias: sm
        - pkg: github.com/prometheus/client_model/go
          alias: dto
        - pkg: github.com/grafana/sm-alerts/proto/alerts/v1
          alias: alertspb
        - pkg: github.com/prometheus/common/model
          alias: prommodel
        - pkg: github.com/go-kit/log
          alias: kitlog
        - pkg: github.com/grafana/auth/pkg/client
          alias: authClient
        - pkg: errors
          alias: stderrors
        - pkg: github.com/grafana/gsm-api-go-client
          alias: gsmClient
      no-unaliased: false
      no-extra-aliases: true
    ireturn:
      allow:
        - anon
        - error
        - stdlib
        - generic
        - github.com/go-kit/log.Logger
        - github.com/grafana/gsm/internal/.*
        - github.com/jackc/pgx/v5\.Tx
    lll:
      line-length: 120
      tab-width: 8
    maintidx:
      under: 20
    mnd:
      checks:
        - argument
        - case
        - condition
        - operation
        - return
        - assign
      ignored-numbers:
        - "0600"
        - "0644"
        - "0666"
        - "0700"
        - "0755"
      ignored-functions:
        - ^math\.
        - ^http\.StatusText$
    nakedret:
      max-func-lines: 10
    nolintlint:
      require-explanation: true
      require-specific: true
      allow-unused: false
    rowserrcheck:
      packages:
        - github.com/jmoiron/sqlx
    varnamelen:
      ignore-type-assert-ok: true
      ignore-map-index-ok: true
      ignore-chan-recv-ok: true
      ignore-decls:
        - i int
        - r rune
        - ts timeseries
        - id int64
        - wg sync.WaitGroup
        - w http.ResponseWriter
        - tx *sql.Tx
        - tx pgx.Tx
    wrapcheck:
      ignore-package-globs:
        - github.com/grafana/gsm/internal/*
    wsl_v5:
      allow-first-in-block: true
      allow-whole-block: false
      branch-max-lines: 2
  exclusions:
    generated: lax
    presets:
      - comments
      - common-false-positives
      - legacy
      - std-error-handling
    rules:
      - linters:
          - exhaustruct
          - funlen
          - gochecknoglobals
          - maintidx
        path: _test.go
      - path: (.+)\.go$
        text: (func|method|type|var|struct field|func parameter|method parameter) [^ ]+ should be .*
      - linters:
          - gosmopolitan
        path: (.+)_test\.go
    paths:
      - proto/.*.go
      - third_party$
      - builtin$
      - examples$
formatters:
  enable:
    - gofmt
    - goimports
  exclusions:
    generated: lax
    paths:
      - proto/.*.go
      - third_party$
      - builtin$
      - examples$
